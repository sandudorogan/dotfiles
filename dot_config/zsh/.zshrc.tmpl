export ZSH="$HOME/.config/oh-my-zsh"

# Direnv
command -v direnv &>/dev/null && eval "$(direnv hook zsh)"

# Shell options
autoload -U colors && colors	# Load colors
setopt autocd		# Automatically cd into typed directory.
stty stop undef		# Disable ctrl-s to freeze terminal.
setopt interactive_comments

# History configuration
HISTSIZE=10000000
SAVEHIST=10000000
HISTFILE=~/.cache/zsh/history

# Import colorscheme from 'wal' asynchronously
[ -f ~/.cache/wal/sequences ] && (cat ~/.cache/wal/sequences &)

# Oh My Zsh Theme
ZSH_THEME="robbyrussell"

# Oh My Zsh Settings
HYPHEN_INSENSITIVE="true"
COMPLETION_WAITING_DOTS="true"
HIST_STAMPS="dd/mm/yyyy"

# Oh My Zsh auto-update configuration (modern zstyle format)
zstyle ':omz:update' mode auto
zstyle ':omz:update' frequency 13

# Fzf integration (modern approach)
command -v fzf &>/dev/null && source <(fzf --zsh)

# Vim mode settings
VI_MODE_SET_CURSOR=true
VI_MODE_RESET_PROMPT_ON_MODE_CHANGE=true

# Oh My Zsh plugins
plugins=(
    git
    tmux
    colorize
    colored-man-pages
    copybuffer
    common-aliases
    emoji
    emoji-clock
    web-search
    fancy-ctrl-z
    urltools
    zsh-navigation-tools
    zsh-interactive-cd
    universalarchive
    vi-mode
    lein
{{ if eq .chezmoi.os "darwin" -}}
    macos
{{ end -}}
    zsh-autosuggestions
    zsh-syntax-highlighting
 )

source $ZSH/oh-my-zsh.sh

# User configuration

# Initialize Atuin (after Oh My Zsh plugins)
command -v atuin &>/dev/null && eval "$(atuin init zsh)"

# Zoxide
command -v zoxide &>/dev/null && eval "$(zoxide init zsh)"

# Use vim keys in tab complete menu:
bindkey -M menuselect 'h' vi-backward-char
bindkey -M menuselect 'k' vi-up-line-or-history
bindkey -M menuselect 'l' vi-forward-char
bindkey -M menuselect 'j' vi-down-line-or-history
bindkey -v '^?' backward-delete-char

bindkey '^ ' autosuggest-accept

# export MANPATH="/usr/local/man:$MANPATH"

# Compilation flags
# export ARCHFLAGS="-arch x86_64"

export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm

# Load aliases and shortcuts if existent
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutrc" ] && source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/shortcutrc"
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/shell/aliasrc" ] && source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/aliasrc"
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/shell/zshnameddirrc" ] && source "${XDG_CONFIG_HOME:-$HOME/.config}/shell/zshnameddirrc"

{{ if eq .chezmoi.os "darwin" -}}
# Docker-sync workaround for macOS
export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES
{{ end -}}

# Thefuck alias
command -v thefuck &>/dev/null && eval $(thefuck --alias)

{{ if eq .chezmoi.os "darwin" -}}
# PATH additions
export PATH="$(brew --prefix)/opt/openjdk/bin:$PATH"
{{ end -}}

# Completions
[ -s "{{ .chezmoi.homeDir }}/.bun/_bun" ] && source "{{ .chezmoi.homeDir }}/.bun/_bun"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# Load custom environment if it exists
[ -f "$HOME/.local/bin/env" ] && . "$HOME/.local/bin/env"
