{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# Hash: {{ include ".chezmoidata/packages.yaml" | sha256sum }}
# This script re-runs when packages.yaml changes

set -euo pipefail

echo "==> Installing Homebrew packages..."

# Ensure brew is available
eval "$(/opt/homebrew/bin/brew shellenv)"

brew uninstall --cask --force font-jetbrains-mono-nerd-font 2>/dev/null || true
rm -f ~/Library/Fonts/JetBrainsMonoNLNerdFont-*.ttf 2>/dev/null || true

brew bundle --file=/dev/stdin <<EOF
# Taps
{{ range .homebrew.taps -}}
tap "{{ . }}"
{{ end }}
# Formulae
{{ range .homebrew.formulae -}}
brew "{{ . }}"
{{ end }}
# Casks
{{ range .homebrew.casks -}}
cask "{{ . }}"
{{ end -}}
EOF

echo "==> Homebrew packages installed"
{{ end -}}
